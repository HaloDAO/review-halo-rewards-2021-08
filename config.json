{
    "client_name": "HaloDAO",
    "commit_hash": "ba98ffa136d84ba47bcd2583c411d16d40ab9d5f",
    "date": "August 2021",
    "date_interval": "16th of August to 27th of August, 2021",
    "issues": [
        {
            "active_lock_reason": null,
            "assignee": null,
            "assignees": [],
            "author_association": "CONTRIBUTOR",
            "body": "**Description**\r\n\r\n[HAL](https://www.hal.xyz/) says they call a webhook after 3 confirmations. This is not enough for the Bridge:\r\n\r\nhttps://etherscan.io/block/12784345/f\r\n\r\n**Recommendation**\r\n",
            "closed_at": "2021-08-18T02:19:12Z",
            "comments": 2,
            "comments_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/4/comments",
            "created_at": "2021-08-16T06:57:59Z",
            "events_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/4/events",
            "html_url": "https://github.com/monoceros-alpha/review-halo-rewards-2021-08/issues/4",
            "id": 971426080,
            "labels": [
                {
                    "color": "FF9500",
                    "default": false,
                    "description": null,
                    "id": 3264753210,
                    "name": "Medium",
                    "node_id": "MDU6TGFiZWwzMjY0NzUzMjEw",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/labels/Medium"
                }
            ],
            "labels_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/4/labels{/name}",
            "locked": false,
            "milestone": null,
            "node_id": "MDU6SXNzdWU5NzE0MjYwODA=",
            "number": 4,
            "performed_via_github_app": null,
            "repository_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08",
            "state": "closed",
            "title": "[Bridge] HAL service might cause a double-spend",
            "updated_at": "2021-08-26T08:02:20Z",
            "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/4",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
                "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
                "followers_url": "https://api.github.com/users/andreiashu/followers",
                "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
                "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andreiashu",
                "id": 342638,
                "login": "andreiashu",
                "node_id": "MDQ6VXNlcjM0MjYzOA==",
                "organizations_url": "https://api.github.com/users/andreiashu/orgs",
                "received_events_url": "https://api.github.com/users/andreiashu/received_events",
                "repos_url": "https://api.github.com/users/andreiashu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andreiashu"
            }
        },
        {
            "active_lock_reason": null,
            "assignee": null,
            "assignees": [],
            "author_association": "CONTRIBUTOR",
            "body": "**Description**\r\n\r\nThe `_swap` function uses Uniswap V2 to swap between different tokens but the comment incorrectly mentions `sushiswap`:\r\n\r\nhttps://github.com/monoceros-alpha/review-halo-rewards-2021-08/blob/215f43240eddb2b6c52e3550d6323b9637d7190f/code/contracts/PotOfGold.sol#L86-L87\r\n\r\n**Recommendation**\r\n\r\nUpdate the comment to read `Uniswap V2`.\r\n",
            "closed_at": "2021-08-16T06:34:57Z",
            "comments": 2,
            "comments_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/3/comments",
            "created_at": "2021-08-16T06:24:10Z",
            "events_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/3/events",
            "html_url": "https://github.com/monoceros-alpha/review-halo-rewards-2021-08/issues/3",
            "id": 971408262,
            "labels": [
                {
                    "color": "FFCC00",
                    "default": false,
                    "description": null,
                    "id": 3264753146,
                    "name": "Minor",
                    "node_id": "MDU6TGFiZWwzMjY0NzUzMTQ2",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/labels/Minor"
                }
            ],
            "labels_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/3/labels{/name}",
            "locked": false,
            "milestone": null,
            "node_id": "MDU6SXNzdWU5NzE0MDgyNjI=",
            "number": 3,
            "performed_via_github_app": null,
            "repository_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08",
            "state": "closed",
            "title": "Wrong AMM name in code documentation",
            "updated_at": "2021-08-26T08:02:30Z",
            "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/3",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
                "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
                "followers_url": "https://api.github.com/users/andreiashu/followers",
                "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
                "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andreiashu",
                "id": 342638,
                "login": "andreiashu",
                "node_id": "MDQ6VXNlcjM0MjYzOA==",
                "organizations_url": "https://api.github.com/users/andreiashu/orgs",
                "received_events_url": "https://api.github.com/users/andreiashu/received_events",
                "repos_url": "https://api.github.com/users/andreiashu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andreiashu"
            }
        },
        {
            "active_lock_reason": null,
            "assignee": null,
            "assignees": [],
            "author_association": "CONTRIBUTOR",
            "body": "**Description**\r\n\r\nThe `_toRNBW` function is called from `_convert` in order to convert `USDC` tokens to `RNBW` tokens:\r\n\r\nhttps://github.com/monoceros-alpha/review-halo-rewards-2021-08/blob/215f43240eddb2b6c52e3550d6323b9637d7190f/code/contracts/PotOfGold.sol#L87-L94\r\n\r\nBut `_toRNBW` is a wrapper for `_swap` function:\r\n\r\nhttps://github.com/monoceros-alpha/review-halo-rewards-2021-08/blob/215f43240eddb2b6c52e3550d6323b9637d7190f/code/contracts/PotOfGold.sol#L128-L134\r\n\r\nThe presence of this wrapper function makes the code harder to follow.\r\n\r\n**Recommendation**\r\n\r\nPlease call `_swap` directly from `_covert` and remove the wrapper `_toRNBW` function to help with the readability of the code.\r\n\r\n",
            "closed_at": "2021-08-27T09:48:33Z",
            "comments": 2,
            "comments_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/2/comments",
            "created_at": "2021-08-16T05:46:08Z",
            "events_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/2/events",
            "html_url": "https://github.com/monoceros-alpha/review-halo-rewards-2021-08/issues/2",
            "id": 971388086,
            "labels": [
                {
                    "color": "667788",
                    "default": false,
                    "description": null,
                    "id": 3264753054,
                    "name": "Report",
                    "node_id": "MDU6TGFiZWwzMjY0NzUzMDU0",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/labels/Report"
                },
                {
                    "color": "FFCC00",
                    "default": false,
                    "description": null,
                    "id": 3264753146,
                    "name": "Minor",
                    "node_id": "MDU6TGFiZWwzMjY0NzUzMTQ2",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/labels/Minor"
                }
            ],
            "labels_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/2/labels{/name}",
            "locked": false,
            "milestone": null,
            "node_id": "MDU6SXNzdWU5NzEzODgwODY=",
            "number": 2,
            "performed_via_github_app": null,
            "repository_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08",
            "state": "closed",
            "title": "Unnecessary wrapper function `_toRNBW`",
            "updated_at": "2021-08-27T09:48:33Z",
            "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/2",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
                "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
                "followers_url": "https://api.github.com/users/andreiashu/followers",
                "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
                "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andreiashu",
                "id": 342638,
                "login": "andreiashu",
                "node_id": "MDQ6VXNlcjM0MjYzOA==",
                "organizations_url": "https://api.github.com/users/andreiashu/orgs",
                "received_events_url": "https://api.github.com/users/andreiashu/received_events",
                "repos_url": "https://api.github.com/users/andreiashu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andreiashu"
            }
        },
        {
            "active_lock_reason": null,
            "assignee": null,
            "assignees": [],
            "author_association": "CONTRIBUTOR",
            "body": "**Description**\r\n\r\nThe _owner_ of the `PotOfGold` contract can issue a call to `convert` (or `convertMultiple`) functions in order to convert the accumulated `token` amount into RNBW tokens:\r\n\r\nhttps://github.com/monoceros-alpha/review-halo-rewards-2021-08/blob/215f43240eddb2b6c52e3550d6323b9637d7190f/code/contracts/PotOfGold.sol#L50\r\n\r\nAn intermediary conversion step is required, whereby the amount of accumulated `token` is first converted to `USDC`. The issue here is that the `Curve.originSwap` function gets passed `0` as the `_minTargetAmount` argument and exposes the owner to a price manipulation attack (more details below):\r\n\r\nhttps://github.com/monoceros-alpha/review-halo-rewards-2021-08/blob/215f43240eddb2b6c52e3550d6323b9637d7190f/code/contracts/PotOfGold.sol#L83-L84\r\n\r\nDefinition of the `originSwap` function:\r\n\r\nhttps://github.com/monoceros-alpha/review-halo-rewards-2021-08/blob/215f43240eddb2b6c52e3550d6323b9637d7190f/code/contracts/amm/Curve.sol#L452-L458\r\n\r\nThe final step converts the available `USDC` into `RNBW` using Uniswap V2 contract but the two calls to `pair.swap()` are also vulnerable to a price manipulation attack:\r\n\r\nhttps://github.com/monoceros-alpha/review-halo-rewards-2021-08/blob/215f43240eddb2b6c52e3550d6323b9637d7190f/code/contracts/PotOfGold.sol#L116-L124\r\n\r\nThe reason why the above two implementations are vulnerable to price manipulation is explained in the Uniswap V2 [**Safety Considerations** section](https://docs.uniswap.org/protocol/V2/guides/smart-contract-integration/trading-from-a-smart-contract):\r\n\r\n> Because Ethereum transactions occur in an adversarial environment, smart contracts that do not perform safety checks can be exploited for profit. If a smart contract assumes that the current price on Uniswap is a \"fair\" price without performing safety checks, it is vulnerable to manipulation. A bad actor could e.g. easily insert transactions before and after the swap (a \"sandwich\" attack) causing the smart contract to trade at a much worse price, profit from this at the trader's expense, and then return the contracts to their original state. (One important caveat is that these types of attacks are mitigated by trading in extremely liquid pools, and/or at low values.)\r\n\r\n**Recommendation**\r\n\r\nThe best way to protect against these attacks is to use an external price feed or \"price oracle\". The best \"oracle\" is simply traders' off-chain observation of the current price, which can be passed into the trade as a safety check.\r\n\r\nThe `convert` function can accept an additional parameter `minRNBWAmount` that can be checked after the two above steps are performed to ensure that an expected minimum amount of RNBW tokens were transferred to the Rainbow Pool.\r\n\r\n**References**\r\n\r\n[Uniswap V2 Documentation: Implement a Swap](https://docs.uniswap.org/protocol/V2/guides/smart-contract-integration/trading-from-a-smart-contract)\r\n\r\n[DEFI Sandwich Attack Explaination](https://medium.com/coinmonks/defi-sandwich-attack-explain-776f6f43b2fd)\r\n\r\n[Rapid Rise of MEV in Ethereum](https://medium.com/etherscan-blog/rapid-rise-of-mev-in-ethereum-9bcb62e53517)\r\n",
            "closed_at": "2021-08-27T09:50:33Z",
            "comments": 2,
            "comments_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/1/comments",
            "created_at": "2021-08-16T05:33:37Z",
            "events_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/1/events",
            "html_url": "https://github.com/monoceros-alpha/review-halo-rewards-2021-08/issues/1",
            "id": 971382697,
            "labels": [
                {
                    "color": "667788",
                    "default": false,
                    "description": null,
                    "id": 3264753054,
                    "name": "Report",
                    "node_id": "MDU6TGFiZWwzMjY0NzUzMDU0",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/labels/Report"
                },
                {
                    "color": "FF9500",
                    "default": false,
                    "description": null,
                    "id": 3264753210,
                    "name": "Medium",
                    "node_id": "MDU6TGFiZWwzMjY0NzUzMjEw",
                    "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/labels/Medium"
                }
            ],
            "labels_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/1/labels{/name}",
            "locked": false,
            "milestone": null,
            "node_id": "MDU6SXNzdWU5NzEzODI2OTc=",
            "number": 1,
            "performed_via_github_app": null,
            "repository_url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08",
            "state": "closed",
            "title": "`PotOfGold.convert()` is vulnerable to price manipulation attacks",
            "updated_at": "2021-08-27T09:50:33Z",
            "url": "https://api.github.com/repos/monoceros-alpha/review-halo-rewards-2021-08/issues/1",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
                "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
                "followers_url": "https://api.github.com/users/andreiashu/followers",
                "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
                "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/andreiashu",
                "id": 342638,
                "login": "andreiashu",
                "node_id": "MDQ6VXNlcjM0MjYzOA==",
                "organizations_url": "https://api.github.com/users/andreiashu/orgs",
                "received_events_url": "https://api.github.com/users/andreiashu/received_events",
                "repos_url": "https://api.github.com/users/andreiashu/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/andreiashu"
            }
        }
    ],
    "person_days": "20",
    "project_name": "Halo Rewards",
    "review_period": "2 weeks",
    "source_repository": "git@github.com:HaloDAO/halo-rewards.git",
    "template": "./Readme.md.mustache"
}